---
layout: post
title: 'Netty第三篇'
date: 2020-9-17
author: Warmingzzz
cover: 'http://on2171g4d.bkt.clouddn.com/jekyll-banner.png'
tags: Netty

---

## Netty长连接原理

### 主要逻辑

使用netty实现长连接，主要靠心跳来维持服务端及客户端连接。

主要的实现逻辑如下：

#### 服务端

1、服务端在网络空闲操作一段时间后，服务端失败心跳计数器加1；

2、如果收到客户端的ping心跳包，则清零心跳计数器，如果连续n次没收到客户端的ping心跳包，则关闭链路，释放资源，等待客户端重新连接。

#### 客户端

1、客户端网络空闲在一定时间内没有进行写操作，则发送一个ping心跳包。

2、如果服务器端没在发送下一个心跳包之前回复pong心跳包，则失败心跳计数器加1.

3、如果客户端连续发送n（此处根据具体业务定义）次ping包，服务器均没有回复pong心跳包，则客户端断开连接，

间隔一段时间进行重连操作，直至连接服务器成功。